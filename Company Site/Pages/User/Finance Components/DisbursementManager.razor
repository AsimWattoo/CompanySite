@using Company_Site.Base;
@using Company_Site.Data;
@inherits BaseAddPage<DisburmentModel, int>
@using Company_Site.Pages.Components;

<CollapsibleContainer Title="Disbursement">
    <EditForm Model="NewEntry" class="mt-3" OnValidSubmit="Save">

        <DataAnnotationsValidator/>

        <MultiErrorView Errors="_errors"/>

        <div class="row  my-2">
            <div class="col-md-6">
                <label for="borrowerSelect">Select Borrower</label>
                <InputSelect ValueChanged="@BorrowerCodeChanged" TValue="int" Value=@NewEntry.BorrowerCode ValueExpression="@(() => NewEntry.BorrowerCode)" class="form-select">
                    <option value="-1" selected>--------- Select Option -------</option>
                    @foreach(Account acc in Borrowers)
                    {
                        <option value="@acc.BorrowerCode">@acc.Company</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => NewEntry.BorrowerCode)" />
            </div>
            <div class="col-md-2"></div>
            <div class="col-md-3">
                <label for="borrowerCode">Borrower Code</label>
                <label class="form-control disabled empty-label">@NewEntry.BorrowerCode</label>
            </div>
        </div>
        <div class="row  my-2">
            <div class="col-md-6">
                <label for="date">Date</label>
                <input type="date" @bind-value=NewEntry.Date class="form-control"/>
            </div>
            <div class="col-md-2"></div>
            <div class="col-md-3">
                <label for="amount">Amount</label>
                <InputNumber id="amount" class="form-control" type="text" @bind-Value="NewEntry.Amount"/>
                <ValidationMessage For="@(() => NewEntry.Amount)" />
            </div>
        </div>
        <div class="row my-2">
            <div class="col-md-3">
                <label for="note">Note</label>
                <InputText id="note" class="form-control" @bind-Value="NewEntry.Note"/>
            </div>
            <div class="col-md-3">
                <label for="billNumber">Adjust Towards</label>
                <InputSelect @bind-Value=NewEntry.AdjustTowards class="form-select">
                    <option selected>---- Select Option ----</option>
                    @foreach(DebtProfileModel debtProfile in debtProfiles)
                    {
                        <option value="@debtProfile.AccountNumber">@debtProfile.AccountNumber - @debtProfile.Facility</option>
                    }
                </InputSelect>
            </div>
        </div>
        <div class="d-flex justify-content-center mt-4">
            <a @onclick="Clear" class="btn btn-danger me-3">Clear</a>
            <input class="btn btn-primary" value="@(ShouldAdd ? "Add" : "Edit")" type="submit"/>
        </div>
    </EditForm>
</CollapsibleContainer>

<Table T="DisburmentModel" 
    T2="int" 
    ShowSerialNumber=true 
    Items="@Enteries" 
    Headers="@Headers" 
    GetId="@GetId" 
    OnDelete="DeleteRecord" 
    OnEdit="EditRecord" 
    OnSearch="Search"
    ValueCallback="ValueCallback">
</Table>
